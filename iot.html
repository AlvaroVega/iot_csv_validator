<!DOCTYPE html>
<html>
  <head>
    <script src="http://code.jquery.com/jquery-1.12.4.js"></script>    
    <title>IOT Platform for SmartCities: CSV validator</title>
  </head>

<body>

<form class="form-signin" id="CSValidatorForm" method="post">
  <h2 class="form-signin-heading">Validate CSV</h2>
  <input class="form-control" type="text" required name="conf" id="conf" placeholder="expr1,expr2,expr3,..." size="80">
  <button type="reset" value="Reset">Reset</button> <p>
  <button id="upload">upload</button>    
  <input type="file" name="filename" id="filename">
</form>

<p>

<div clas="help">Help for regex:
  <ul>
  <li> alphanumeric  ^[a-z0-9]+$ </li>
  <li> numeric  ^[0-9]+$ </li>
  <li> alphabetic  ^[a-z]+$ </li>  
  </ul>
</div>


<div class="csv">CSV: <p></div>

<div class="error">ERRORS: <p></div>


<script type="text/javascript">
  
$(document).ready(function(){
    $('#upload').click(function(){
        console.log("document ready");
        var csv = $('#filename');
        console.log("csv: "+csv);
        var conf = $('#conf').val();
        var expr = conf.split(',');

        var csvFile = csv[0].files[0];
        var ext = csv.val().split(".").pop().toLowerCase();
        console.log("extension file:"+ext);
        console.log("content file:"+csvFile);

        if($.inArray(ext, ["csv"]) === -1){
            alert('upload csv');
            return false;
        }
        if(csvFile != undefined){
            reader = new FileReader();
            reader.onload = function(e){
                csvRows = e.target.result.split(/\r|\n|\r\n/);
                for (var row in csvRows) {
                   var currentRow = csvRows[row].split(',');
                   for (var item in currentRow) {
                      var currentItem = currentRow[item]; 
                      // Check item with expr[item]
                      var regex = new RegExp(expr[item], "i");
                      if (row > 0 && currentItem.length > 0 && !regex.test(currentItem)) {
                         $('.error').append("error in row " + row + " item " + item + " : " + currentItem);
                      }
                   }
                   $('.csv').append(csvRows[row]);
                   $('.csv').append('<p>');
                } 
            }
            reader.readAsText(csvFile);
        }
    });
});

</script>


</body>
</html>
